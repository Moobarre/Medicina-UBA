<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Curricular Medicina</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f3f4f6;
      color: #111827;
      margin: 0;
      padding: 2rem;
    }
    h1, h2 {
      text-align: center;
      color: #1f2937;
    }
    .grid {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
    }
    .column {
      background: #fff;
      padding: 1rem;
      border-radius: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      min-width: 250px;
    }
    .subject {
      background: #e5e7eb;
      padding: 0.5rem;
      border-radius: 0.5rem;
      margin: 0.5rem 0;
      position: relative;
      cursor: pointer;
    }
    .subject.locked {
      background: #d1d5db;
      cursor: not-allowed;
    }
    .subject .final-grade {
      margin-top: 0.5rem;
      display: none;
    }
    .subject.approved .final-grade {
      display: block;
    }
    .tooltip {
      visibility: hidden;
      background-color: #111827;
      color: #fff;
      text-align: center;
      border-radius: 4px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .subject.locked:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular de Medicina</h1>
  <div class="grid" id="curriculum"></div>

  <script>
    const data = {
      "AÑO 1: CBC": [
        "Introducción al Pensamiento Científico",
        "Introducción al Conocimiento de la Sociedad y Estado",
        "Química",
        "Fisica e Introduccion a la biofisica",
        "Biologia e Introduccion a la Biología Celular",
        "Matemática"
      ],
      "AÑO 2: CICLO BIOMÉDICO": [
        { name: "Anatomia", reqs: ["CBC"] },
        { name: "Histología", reqs: ["CBC"] },
        { name: "Embriologia", reqs: ["CBC"] },
        { name: "Biología Molecular y Genética", reqs: ["CBC"] },
        { name: "Salud Mental", reqs: ["CBC"] },
        { name: "Salud Pública", reqs: ["CBC"] },
        { name: "Bioética", reqs: ["CBC"] },
        { name: "Curso de Inglés para Ciencias de la Salud", reqs: ["CBC"] }
      ],
      "AÑO 3": [
        { name: "Fisiologia y Biofisica", reqs: ["Anatomia", "Histología", "Embriologia", "Biología Molecular y Genética"] },
        { name: "Bioquímica", reqs: ["Anatomia", "Histología", "Embriologia", "Biología Molecular y Genética"] },
        { name: "Inmunologia humana", reqs: ["Anatomia", "Histología", "Embriologia", "Biología Molecular y Genética"] },
        { name: "Microbiologia y Parasitologia", reqs: ["Inmunologia humana", "Bioquímica"] }
      ],
      "CICLO CLÍNICO - MEDICINA": [
        { name: "Medicina I", reqs: ["AÑO 2: CICLO BIOMÉDICO", "AÑO 3"] },
        { name: "Patología", reqs: ["AÑO 2: CICLO BIOMÉDICO", "AÑO 3"] },
        { name: "Farmacología I", reqs: ["AÑO 2: CICLO BIOMÉDICO", "AÑO 3"] },
        { name: "Medicina II", reqs: ["Medicina I", "Patología"] },
        { name: "Diagnóstico por imágenes", reqs: ["Medicina I", "Patología"] },
        { name: "Nutrición", reqs: ["Medicina I", "Patología"] },
        { name: "Dermatología", reqs: ["Medicina I", "Patología"] },
        { name: "Infectología", reqs: ["Medicina I", "Patología"] },
        { name: "Neumología", reqs: ["Medicina I", "Patología"] },
        { name: "Neurología", reqs: ["Medicina I", "Patología"] }
      ],
      "CICLO CLÍNICO - CIRUGÍA": [
        { name: "Cirugía general", reqs: ["Medicina I", "Patología"] },
        { name: "Urología", reqs: ["Medicina I", "Patología"] },
        { name: "Traumatología y Ortopedia", reqs: ["Medicina I", "Patología"] },
        { name: "Oftalmología", reqs: ["Medicina I", "Patología"] },
        { name: "Otorrinolaringología", reqs: ["Medicina I", "Patología"] },
        { name: "Neurocirugía", reqs: ["Medicina I", "Patología"] }
      ],
      "CICLO CLÍNICO - TOCOGINECOLOGÍA": [
        { name: "Obstetricia", reqs: ["Medicina I", "Patología"] },
        { name: "Ginecología", reqs: ["Medicina I", "Patología"] },
        { name: "Pediatría", reqs: ["Medicina I", "Patología"] },
        { name: "Farmacología II", reqs: ["Medicina I", "Patología"] },
        { name: "Psiquiatría", reqs: ["Medicina I", "Patología"] },
        { name: "Toxicología", reqs: ["Medicina I", "Patología"] },
        { name: "Medicina Legal y Deontología Médica", reqs: ["Medicina I", "Patología"] }
      ]
    };

    const storageKey = 'malla-medicina';
    const savedProgress = JSON.parse(localStorage.getItem(storageKey)) || {};

    const curriculum = document.getElementById('curriculum');
    const completed = new Set(Object.keys(savedProgress).filter(k => savedProgress[k]?.status === 'approved'));

    for (const [year, subjects] of Object.entries(data)) {
      const col = document.createElement('div');
      col.className = 'column';
      col.innerHTML = `<h2>${year}</h2>`;

      for (const subj of subjects) {
        const name = typeof subj === 'string' ? subj : subj.name;
        const reqs = typeof subj === 'string' ? [] : subj.reqs;

        const div = document.createElement('div');
        div.className = 'subject';
        div.textContent = name;
        div.dataset.name = name;

        if (!reqsMet(reqs)) {
          div.classList.add('locked');
          const tooltip = document.createElement('div');
          tooltip.className = 'tooltip';
          tooltip.textContent = `Falta: ${reqs.filter(r => !completed.has(r)).join(', ')}`;
          div.appendChild(tooltip);
        } else {
          div.addEventListener('click', () => toggleSubject(div));
        }

        if (savedProgress[name]) {
          div.classList.add(savedProgress[name].status);
          if (savedProgress[name].grade) {
            const input = createGradeInput(name, savedProgress[name].grade);
            div.appendChild(input);
          }
        }

        col.appendChild(div);
      }

      curriculum.appendChild(col);
    }

    function reqsMet(reqs) {
      return reqs.every(r => completed.has(r));
    }

    function toggleSubject(div) {
      const name = div.dataset.name;
      const current = savedProgress[name]?.status;
      if (current === 'approved') {
        div.classList.remove('approved');
        div.querySelector('.final-grade')?.remove();
        savedProgress[name] = { status: 'regular' };
      } else if (current === 'regular') {
        div.classList.remove('regular');
        div.classList.add('approved');
        const input = createGradeInput(name);
        div.appendChild(input);
        savedProgress[name] = { status: 'approved' };
      } else {
        div.classList.add('regular');
        savedProgress[name] = { status: 'regular' };
      }
      localStorage.setItem(storageKey, JSON.stringify(savedProgress));
    }

    function createGradeInput(name, value = '') {
      const input = document.createElement('input');
      input.placeholder = 'Nota final';
      input.className = 'final-grade';
      input.value = value;
      input.addEventListener('change', () => {
        savedProgress[name].grade = input.value;
        localStorage.setItem(storageKey, JSON.stringify(savedProgress));
      });
      return input;
    }
  </script>
</body>
</html>
